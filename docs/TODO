* openしてクローズしていないファイルディスクリプタがある状態でiotctxを破棄してもsegvにならないことを確認する
  - ファイルを未クローズの時にunmountが走行するとv-nodeが解放されて
    ファイルディスクリプタから改造済みのv-nodeが参照されたままになり
    不正メモリアクセスになる問題を修正すること
* mutex_lockでエラーチェックをしていないものがある
* read/writeのfile_privateの位置が異なるので修正
* ファイル・ディレクトリのread/writeを伴うオペレーションでvnode lockをとるように修正
  - rename処理でデッドロックを引き起こさないようにディレクトリエントリのv-nodeロックを
    v-node ID順に行うようにすること
* vfsオペレーションにアクセス権チェック, I-node時刻更新,
  リードオンリーファイルシステムチェックを入れる

* ファイル/ディレクトリ作成時についてのメモ
  ファイル作成先のディレクトリに名前とinode(ディレクトリエントリ)作成する
  新規作成したファイルのnlinkを1にする。
  新規作成したファイルが, ディレクトリだった場合は, 作成したinode(作成対象のディレクトリ)の
  nlinkを+1
  (作成したディレクトリのnlinkは2になる), 親ディレクトリのnlinkを+1する

* システムコール<=>vfs間IFを実装
  - vfs_openのレビュールートテスト
    - 参照カウンタの一貫性
    - 多重ロック整合性確認
  - creatシステムコールIFを実装

* mount/unmount/fd+ioctxの全ルートテストを実施
* 可変長のIDビットマップ機構を導入し, VFSの上限制限を撤廃
* ツールにchdir/mkdir/mknodを追加
* プロセスヒープの伸縮処理を追加
* スレッド終了処理で全てのメンバが解放されていることをレビューで確認
* プロセス内のすべてのスレッドに対する操作を行うマクロを追加

* RB_TREEの比較関数の仕様を確認して修正(大小関係が逆になっているものがある) [澄み]
* アンマウント時にmount->m_root(マウントポイントのv-node)の参照が0になり,
  root v-nodeとマウントポイントの双方が正しく解放されること(root v-nodeの解放に伴って
  マウントポイントの参照数が0になること)を確認する。[済み]
  =>rootマウント時, 通常のマウント時ともにroot v-node, マウントポイントともに解放されることを
  デバッガで追跡して確認した。
* 物理ファイルシステム層でvfs_*型が直接見えるのはおかしいので修正する[済み]
* simplefs_inode_truncate_downを他のファイルシステムと同構成にする[済み]

* mutex/waitキュー操作を実装[済み]
  - スレッド管理実装後にTODOを消化し, mutexのテストを追加する
* vfs_mountをファイルシステムツリーをたどってファイルシステムを自動認識するIFにし,
  ファイルシステム名付きでマウントするIFの名称をvfs_mount_with_fsnameに名称変更[済み]
* ファイルモードの獲得をfs_vnode_lookupからfs_getvnodeに移動[済み]
* グローバルrootアンマウント処理を追加[済み]
* v-nodeの参照制御の修正[済み]
  - 参照をgetで加算/putで減算する[済み]
    生成時に設定した参照をget/putで失わないようにしキャッシュとして動作できるようにするため
  - マウント/アンマウント時の参照カウンタ条件(assert)を合わせること[済み]
* vflagsのフラグ操作関数に引数を追加し, フラグのセット・アンセット・チェック処理を共通化[済み]
* mnt_id/vnode_id/ioctx_idにvfs_プレフィックスをつける[済み]
* minixのディスクI-nodeからスーパブロック情報を参照している箇所を引数でスーパブロック情報
  を引き渡すように修正[済み]
* unmap_zoneでinode中のゾーン割り当てを解放する[済み]
  (free_zoneを呼ぶ代わりにそのゾーンへのマップを消去する処理を呼び出す)
* minix_inode_rwをminix_rw_datazoneに名称変更[済み]
* I-node情報のアクセスタイムメンバ更新マクロを作成[済み]
  - atime/mtime/ctimeは別マクロにする[済み]
* スレッド処理の各関数で参照数制御が合うことをレビューで確認[済み]
* カーネルスレッド生成共通処理を追加[済み]
  - カーネルスレッド生成処理を追加 [済み]
  - 既存のスレッドテストをカーネルスレッド生成処理に変更[済み]
  - ユーザスレッド生成処理にはプロセス管理情報を引き渡すように修正[済み]
  - カーネルスレッド生成処理ではカーネルのプロセス管理情報を引き渡す[済み]
  - 引数(argc, argv, environment)を扱えるようにする[済み]
    -- 共通処理のIFを修正(引数のアドレスを追加)[済み]
    -- argc, argv, environmentをスタック上に用意する[済み]
    -- argcの直下に配列領域を用意, ポインタ配列(argv[], environment[])の各要素を設定する[済み]
* プロセスIDにページテーブルのアドレス空間IDを使用するように修正[済み]
  - ASID型, ASID最大値をHALに定義[済み]
  - kern/vm-pgtbl.cでASIDを割当て/解放する[済み]
* スレッド生成処理時にプリエンプションカウンタがクリアされる問題を修正[済み]
  - スレッド情報初期化処理を独立化[済み]
  - スレッド生成共通処理からスレッド情報初期化処理を除去[済み]
  - スレッド生成共通処理に親スレッドへの子スレッド追加処理を追加[済み]
* スレッド終了処理で子スレッド解放処理を追加[済み]
* 論理プロセッサID 0を即値で記載しているところをマクロに置き換える[済み]
* プロセス管理情報の参照制御を追加[済み]
* ユーザページテーブルアロケート[済み]
  - カーネルVPN2のコピー[済み]
* ユーザページテーブルデアロケート[済み]
* hal_copy_kernel_pgtblから呼び出し元にロック獲得位置を変更[済み]
* atomic_add_fetch/atomic_sub_fetchを統計情報カウンタに置き換え[済み]
* カーネルエントリ時にベクタをカーネルベクタに設定[済み]
* ユーザページマップ関数[済み]
* ユーザページコピー関数[済み]
  - extract mapしてマップ先ページアドレスとサイズ、属性を得る
  - マネージドページについて同サイズでページを獲得
  - 同一仮想アドレスにマップ
* CPUのオフライン制御

* 割り込み管理共通部[済み]
* 割り込みコントローラ処理部[済み]
  - Platform-Level Interrupt Controller PLIC[済み]
  - Core-Local Interrupt Controller CLIC[済み]
    https://github.com/riscv/riscv-fast-interrupt/blob/master/clic.adoc
* タイマ有効化/シリアル割り込み確認[済み]
* コールアウトキューを時刻管理情報に移動しロック構成を単純化[済み]
* タイマ管理[済み]
  - ブート時のMTIME(システム時刻0のときのMTIME値)をmscratch情報に保存するように修正。
  - ティックレス
    a) 次回のタイマプログラム時の時刻(次のタイマ割込み発生時刻のMTIME-ブート時のMTIME)を
    b) タイムスペックに換算(us=>timespec)し, 次回のタイマプログラム時の時刻をtimespecで求める
    c)  未処理のハンドラで最も直近のものからtimespecを取得しb)+レイテンシよりも大きい
        最初のエントリを得る
    d) で得たtimespecをmtimeに変換 = timespecのマイクロ秒換算値
    e) で得た値から次回のタイマ時刻を減算した値をtimer_interval_cycに代入

* プロセス管理部(カーネルプロセス)
  - プロセス管理情報の割当て(proc_allocate)
  - プロセス管理情報の解放(proc_free)
  - プロセスへの空間操作
     -- 空間の生成
     -- 空間の解放
     -- 空間の属性変更
     -- 空間を分離
     -- 空間の一部を削除
     -- 空間を結合

* スレッド管理部
  - 優先度継承中にプライオリティを変更するために
    初期化時優先度
    ベース優先度
    実効優先度
    の3つを定義, プライオリティの変更はベース優先度に対して行う
  - スレッド参照処理

* スレッドタイマ(ラウンドロビン)
* プロセス管理部(ユーザプロセス)
* ELF
* テスト1回目(システムコールはデバッグ文字列出力のみ

* fileディスクリプタ管理
* ページキャッシュ管理[済み]
  - ページキャッシュ管理基本部[済み]
  - LRUサポート[済み]
* bdevレイヤでのページキャッシュ<->FSイメージのバッファコピー[済み]
* マウント管理
* vnodeキャッシュ管理
* minixfs
* デバイスIF
* 端末キュー
* init
* shell

* テスト2回目プロセスロード
